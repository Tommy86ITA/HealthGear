@model Device

@{
    ViewData["Title"] = "Conferma Eliminazione o Archiviazione";
    var hasInterventions = Model.Interventions != null && Model.Interventions.Any();
}

<h2 class="mb-4">Conferma Eliminazione o Archiviazione</h2>

<div class="alert alert-warning">
    <p>Sei sicuro di voler eliminare o archiviare il dispositivo <strong>@Model.Name</strong>?</p>

    @if (hasInterventions)
    {
        <p>Questo dispositivo ha interventi registrati. Non pu√≤ essere eliminato direttamente, ma pu√≤ essere archiviato
            con lo stato <strong>"Dismesso"</strong>.</p>
    }
    else
    {
        <p>Questa azione √® definitiva e non pu√≤ essere annullata.</p>
    }
</div>

<form asp-action="DeleteOrArchiveConfirmed" method="post">
    <input type="hidden" asp-for="Id"/>

    @if (hasInterventions)
    {
        <button type="submit" name="action" value="archive" class="btn btn-warning">
            üìÅ Archivia Dispositivo
        </button>
    }
    else
    {
        <div class="mb-3">
            <label for="confirmDeleteInput" class="form-label">Per confermare, digita il nome del dispositivo:</label>
            <input type="text" id="confirmDeleteInput" class="form-control" placeholder="@Model.Name"
                   oninput="validateDeleteInput()"/>
        </div>

        <button type="submit" name="action" value="delete" id="deleteConfirmButton" class="btn btn-danger" disabled>
            ‚ùå Elimina Dispositivo
        </button>
    }

    <a asp-action="Index" class="btn btn-secondary">‚Ü©Ô∏è Annulla</a>
</form>

@section Scripts {
    <script>
        function validateDeleteInput() {
            var input = document.getElementById("confirmDeleteInput").value;
            var confirmButton = document.getElementById("deleteConfirmButton");
            confirmButton.disabled = input.trim() !== "@Model.Name";
        }
    </script>
}