@model IEnumerable<Device>

<h2>Elenco Dispositivi</h2>

@if (TempData["DeviceErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-triangle"></i> @TempData["DeviceErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<table class="table">
    <thead>
    <tr>
        <th>Nome</th>
        <th>Produttore</th>
        <th>Modello</th>
        <th>Numero di Serie</th>
        <th>Stato Manutenzione</th>
        <th>Stato Verifica Elettrica</th>
        <th>Stato Controllo Fisico</th>
        <th>Azioni</th>
    </tr>
    </thead>
    <tbody>
    @foreach (var device in Model)
    {
        <tr>
            <td>@device.Name</td>
            <td>@device.Brand</td>
            <td>@device.Model</td>
            <td>@device.SerialNumber</td>

            <!-- Stato manutenzione -->
            <td>
                @{
                    var daysUntilNextMaintenance = device.NextMaintenance.HasValue
                        ? (device.NextMaintenance.Value - DateTime.Today).Days
                        : -1;
                }
                @if (!device.NextMaintenance.HasValue)
                {
                    <span class="text-danger">Non disponibile</span>
                }
                else if (daysUntilNextMaintenance < 0)
                {
                    <i class="fas fa-wrench text-danger" title="Scaduta"></i>
                }
                else if (daysUntilNextMaintenance <= 60)
                {
                    <i class="fas fa-wrench text-warning" title="In scadenza"></i>
                }
                else
                {
                    <i class="fas fa-wrench text-success" title="Valida"></i>
                }
            </td>

            <!-- Stato verifica elettrica -->
            <td>
                @{
                    var daysUntilNextElectricalTest = device.NextElectricalTest.HasValue
                        ? (device.NextElectricalTest.Value - DateTime.Today).Days
                        : -1;
                }
                @if (!device.NextElectricalTest.HasValue)
                {
                    <span class="text-danger">Non disponibile</span>
                }
                else if (daysUntilNextElectricalTest < 0)
                {
                    <i class="fas fa-bolt text-danger" title="Scaduta"></i>
                }
                else if (daysUntilNextElectricalTest <= 60)
                {
                    <i class="fas fa-bolt text-warning" title="In scadenza"></i>
                }
                else
                {
                    <i class="fas fa-bolt text-success" title="Valida"></i>
                }
            </td>

            <!-- Stato controllo fisico -->
            <td>
                @{
                    if (device.DeviceType != "Radiogeno")
                    {
                        <span></span>
                        <!-- Cella vuota per dispositivi non radiogeni -->
                    }
                    else
                    {
                        var daysUntilNextPhysicalInspection = device.NextPhysicalInspection.HasValue
                            ? (device.NextPhysicalInspection.Value - DateTime.Today).Days
                            : -1;

                        if (!device.NextPhysicalInspection.HasValue)
                        {
                            <span class="text-danger">Non disponibile</span>
                        }
                        else if (daysUntilNextPhysicalInspection < 0)
                        {
                            <i class="fas fa-radiation text-danger" title="Scaduta"></i>
                        }
                        else if (daysUntilNextPhysicalInspection <= 60)
                        {
                            <i class="fas fa-radiation text-warning" title="In scadenza"></i>
                        }
                        else
                        {
                            <i class="fas fa-radiation text-success" title="Valida"></i>
                        }
                    }
                }
            </td>

            <td>
                <a asp-action="Details" asp-route-id="@device.Id" class="btn btn-info btn-sm">
                    <i class="fas fa-eye"></i> Dettagli
                </a>
                <a asp-action="Edit" asp-route-id="@device.Id" class="btn btn-warning btn-sm">
                    <i class="fas fa-edit"></i> Modifica
                </a>
                <a asp-action="Delete" asp-route-id="@device.Id" class="btn btn-danger btn-sm">
                    <i class="fas fa-trash"></i> Elimina
                </a>
            </td>
        </tr>
    }
    </tbody>
</table>

<a asp-action="Create" class="btn btn-primary">
    <i class="fas fa-plus"></i> Aggiungi Nuovo Dispositivo
</a>