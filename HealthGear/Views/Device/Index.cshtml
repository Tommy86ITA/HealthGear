@model IEnumerable<Device>

<h2>Elenco Dispositivi</h2>

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">@TempData["SuccessMessage"]</div>
}

<div class="mb-3">
    <a asp-action="Create" class="btn btn-success">
        <i class="fas fa-plus"></i> Aggiungi Nuovo Dispositivo
    </a>

    <div class="float-end">
        <input type="text" id="searchInput" class="form-control" placeholder="Cerca dispositivi..." onkeyup="filterTable()">
    </div>
</div>

<table class="table table-striped table-hover" id="deviceTable">
    <thead class="table-dark">
        <tr>
            <th>Nome</th>
            <th>Marca</th>
            <th>Modello</th>
            <th>Numero di serie</th>
            <th>Ubicazione</th>
            <th>Prossima manutenzione</th>
            <th class="text-center">Azioni</th>
        </tr>
    </thead>
    <tbody>
    @foreach (var device in Model)
    {
        <tr>
            <td>@device.Name</td>
            <td>@device.Brand</td>
            <td>@device.Model</td>
            <td>@device.SerialNumber</td>
            <td>@device.Location</td>
            <td>@device.NextMaintenance?.ToShortDateString() ?? "Non disponibile"</td>
            <td class="text-center">
                <a asp-action="Edit" asp-route-id="@device.Id" class="btn btn-primary btn-sm">
                    <i class="fas fa-edit"></i> Modifica
                </a>
                <a asp-action="Details" asp-route-id="@device.Id" class="btn btn-info btn-sm">
                    <i class="fas fa-info-circle"></i> Dettagli
                </a>
                <a asp-action="Delete" asp-route-id="@device.Id" class="btn btn-danger btn-sm"
                   onclick="return confirm('Sei sicuro di voler eliminare questo dispositivo?')">
                    <i class="fas fa-trash"></i> Elimina
                </a>
            </td>
        </tr>
    }
    </tbody>
</table>

@section Scripts {
    <script>
        function filterTable() {
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById('searchInput');
            filter = input.value.toUpperCase();
            table = document.getElementById('deviceTable');
            tr = table.getElementsByTagName('tr');

            for (i = 1; i < tr.length; i++) {
                td = tr[i].getElementsByTagName('td');
                let rowVisible = false;
                for (let j = 0; j < td.length - 1; j++) { 
                    if (td[j]) {
                        txtValue = td[j].textContent || td[j].innerText;
                        if (txtValue.toUpperCase().indexOf(filter) > -1) {
                            rowVisible = true;
                        }
                    }
                }
                tr[i].style.display = rowVisible ? '' : 'none';
            }
        }
    </script>
}